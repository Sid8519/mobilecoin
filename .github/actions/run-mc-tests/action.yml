name: Set up Rust and associated tools

inputs:
  package:
    description: Package to run. Can use wildcards.
    type: string
    required: false
    default: "*"
  extra_args:
    description: Additional args
    type: string
    required: false
    default:

runs:
  using: composite
  steps:
    - name: Install cargo nextest
      uses: taiki-e/install-action@nextest
    - name: Run MC tests
      shell: bash
      run: |
        # tell the operating system to remove the file size limit on core dump files
        ulimit -c unlimited

        # Run tests, with JUnit XML output configured via .config/nextest.toml
        cargo nextest run --workspace -p "${{ inputs.package }}" -j 4 \
          --profile ci --locked ${{ inputs.extra_args }}
    - name: Upload core dumps
      uses: ./.github/actions/upload-core-dumps
    - name: Check dirty git
      uses: ./.github/actions/check-dirty-git
